require 'cdepends'
require 'rake/clean'

directory 'objs'

cobject('objs/lib1.o' => ['lib1/lib1.cpp', 'objs'],
        :includes => %w(lib1 lib2)) do |t|
  mkdir_p File.dirname(t.name)
  touch t.name
  puts t.name
end

cobject('objs/lib2.o' => ['lib2/lib2.cpp', 'objs'],
        :includes => %w(lib2)) do |t|
  mkdir_p File.dirname(t.name)
  touch t.name
  puts t.name
end

rule '.h' => '.i' do |r|
  cp r.source, r.name
  puts r.name
end

task :default => ['objs/lib1.o', 'objs/lib2.o']

task :clean do
  rm_rf 'objs'
  rm_rf 'lib1/test_gen.h'
end
